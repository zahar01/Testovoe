# Задача
В рамках задания необходимо: 
- Провести частичный анализ OVAL файла от компании RHEL (https://www.redhat.com/security/data/oval/v2/RHEL8/rhel-8.oval.xml.bz2) на первых 3 уязвимостях (патчах). Определить набор объектов, из которых он строится. Понять основную логику "работы" данного формата. 
- Описать текстом объекты, которые были найдены и для чего они используются. (Не более 2-3 фраз по каждому объекту). 
- В рамках каждого определения уязвимости, есть критерии по ее выявлению: какие из критериев на ваш взгляд лишние? 
- Предложить и кратко описать свой вариант по упрощению формата для описания уязвимости вместе с проверками. 
- После выполненного в предыдущей пунктах анализа, необходимо разработать приложение на языке Python, которое произведет разбор (парсинг) OVAL-файла (достаточно сделать только первые 3 и связанными с ними объекты) и преобразует его в упрощенный формат.


# Решение

## Описание OVAL-файла
ОVAL-файл содержит в себе такие объекты:
- `xml` - определение версии XML-документа
- `oval_definitions` - определения OVAL
	- `generator` - описание чем был сформирован файл 
	- `definitions` - определения (напр. `Patch`, `Vulnerability`, `Inventory`)
	- `tests` - запись связи между `objects` и `states`
	- `objects` - запись о том, какая информация должна быть собрана с ендпойнта
	- `states` - запись об ожидаемом состоянии, сравниваемом с ендпоинтом
	- `variables` - определение переменных, которые могут быть использованы в тестах для выполнения арифметических операций


Набор полей в `definition`:
- `metadata`
	- `title` - заголовок с `id` уязвимости и кратким описанием патча
	- `affected` - затронутая ОС (`family` - семейство ОС)
	- `reference` - ссылка на источник (`ref_id` - `id` уязвимости, на которую ссылаются; `ref_url` - `url` на источник; `source` - название источника)
	- `description` - описание патча
	- `advisory` - сводка по дефе
		- `severity` - серьезность, тяжесть уязвимости
		- `rights` - права
		- `issued` - дата обнаружения
		- `updated` - дата последнего обновления
		- `cve` - `CVE-id` уязвимости (`cvss`- вектор cvss с оценкой `score`; `cwe` - `id` ; `href` - ссылка на запись ; `impact` - влияние, серьезность ; `public` - дата публикации)
		- `bugzilla` - информация с ресурса https://bugzilla.redhat.com/ (ссылка на дефу на этом ресурсе, ее `id` на ресурсе и заголовок)
		- `affected_cpe_list` - список затронутых платформ, описанный в формате cpe
    - `criteria` - представляет собой набор тестов, обернутый в логическое выражение (напр. AND или OR)

## Рассуждения по поводу критериев
Первое, на что упал взгляд, - каждое упоминание версионности продукта (например, `cloud-init is earlier than 0:18.5-1.el8.4`) сопровождается критерием о подписании продукта ключем Red Hat (например, `cloud-init is signed with Red Hat redhatrelease2 key`).

<!-- 
При этом, если перейти к тестам для этих двух критериев, можно заметить, что у них одинаковый объект:
```xml 
(тест 20191992001)
  <red-def:rpminfo_test check="at least one" comment="cloud-init is earlier than 0:18.5-1.el8.4" id="oval:com.redhat.rhba:tst:20191992001" version="635">
    <red-def:object object_ref="oval:com.redhat.rhba:obj:20191992001"/>
    <red-def:state state_ref="oval:com.redhat.rhba:ste:20191992001"/>
  </red-def:rpminfo_test>
```
и
```xml
(тест 20191992002)
  <red-def:rpminfo_test check="at least one" comment="cloud-init is signed with Red Hat redhatrelease2 key" id="oval:com.redhat.rhba:tst:20191992002" version="635">
    <red-def:object object_ref="oval:com.redhat.rhba:obj:20191992001"/>
    <red-def:state state_ref="oval:com.redhat.rhba:ste:20191992002"/>
  </red-def:rpminfo_test>
``` -->

Затем я обнаружил, что у всех тестов, которые связанны с подписью ключа, один и тот же стейт, в котором указан ключ подписи, соответственно, набор критериев можно сократить, например, обьединяя в один критерий подпись и версионность, так как ключ для всех продуктов статичный, меняется только продукт. (Или как-то вынести критерий с ключем)

Также у **каждой** уязвимости есть такой критерий, что выглядит странно, учитывая что набор уязвимостей от RHEL как раз, будто бы логично, что RHEL дожен быть установлен:
```xml
<criterion comment="Red Hat Enterprise Linux must be installed" test_ref="oval:com.redhat.rhba:tst:20191992005"/>
```
При этом, если не учитывать этот критерий, сразу избавляемся от одного уровня вложенности критериев.

**Однако**, мне кажется, что критерии не должны быть лишними, потому что тогда появляется вероятность упустить уязвимость. То есть, на мой взгляд, даже если критерии похожие или повторяются из описания к описанию, избавляться от них не стоит, поэтому в упрощенном формате я их оставлю такими же.

## Упрощенный формат
**`definition`**:
- `id` - идентификатор уязвимости
- `title` - красткая сводка, заголовок уязвимости
- `references` - список альтернативных идентификаторов и источников
- `affected_cpe_list` - я решил убрать поле `affected`, так как оно не полностью описывает затронутые ОС и оставить детальное перечисление всех затронутых ОС
- `issued` - дата обнаружения
- `updated` - дата последнего обновления
- `severity` - текстовая оценка критичности уязвимости
- `criteria` - критерии выявления
    - в `criterion` буду подставлять сразу тест, обьект и стейт, это будет удобно, например, если описания хранятся в одной БД и не придется прыгать по коллекциям и сслыкам, чтобы проследить связь